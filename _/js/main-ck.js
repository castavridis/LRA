/**
  	BASIC FUNCTIONALITY
	-----------------------------------
	- Make map with custom CRS
	- Load CSV data for land plot polygons
	- Load CSV data for land circles
	- Load CSV marker data on hover
	- Color code CSV data based on use
 *//* CONSTANTS ***************************/function markersInView(){var e=0;$.get("_/php/parcels.php",function(t){var n=map.getBounds();for(var r=t.length-1;r>=0;r--){var i=t[r],s=i.polygon;s=s.replace("POLYGON ((","").replace("))","");var o=s.split(","),u=[];for(var a=0;a<o.length;a++){var f=o[a].replace("(","").replace(")","").split(" "),l=f[1],c=f[0];u.push(L.latLng(l,c))}var h=L.polyline(u,{}).getBounds();if(n.contains(h)){for(var p=0;p<u.length-1;p++){l=u[p].lat;c=u[p].lng;l>n._northEast.lat?l=n._northEast.lat:l<n._southWest.lat&&(l=n._southWest.lat);c>n._northEast.lng?c=n._northEast.lng:c>n._southWest.lng&&(c=h._southWest.lng)}e+=polygonArea(u)}}percentInView(e)})}function percentInView(e){document.getElementById("percent").innerHTML=Math.min(100,Math.round((e/totalArea+.01)*100*100)/100)}function getBubbles(){$.get("_/php/bubbles.php",function(e){var t=L.featureGroup().addTo(map),n={stroke:!1,fillColor:"#F90",fillOpacity:.125};for(var r=e.length-1;r>=0;r--){var i=e[r],s=i.id,o=i.x,u=i.y,a=100;L.circle([u,o],a,n).addTo(t)}})}function getParcels(){$.get("_/php/parcels.php",function(e){var t=L.featureGroup().addTo(map),n={stroke:!1,fillColor:"#F0F",fillOpacity:.5,smoothFactor:0,showArea:!0};for(var r=e.length-1;r>=0;r--){var i=e[r],s=i.id,o=i.polygon,u=i.handle,a=i.parcel_id;o=o.replace("POLYGON ((","").replace("))","");var f=o.split(","),l=[];for(var c=0;c<f.length;c++){var h=f[c].replace("(","").replace(")","").split(" "),p=h[1],d=h[0];l.push(L.latLng(p,d))}n.className="poly_"+u;totalArea+=polygonArea(l);L.polygon(l,n).addTo(t).on("mouseover",function(){var e=this.options.className.replace("poly_","");$.get("_/php/parcels.php?handle_id="+e,function(e){console.log(e[0].address)})})}markersInView()})}function polygonArea(e){var t=0,n=e.length-1;for(var r=0;r<e.length;r++){var i=e[r],s=e[n];t+=(Math.abs(i.lat)+Math.abs(s.lat))*(Math.abs(i.lng)+Math.abs(s.lng));n=r}return t/2}var TILE_JSON="http://a.tiles.mapbox.com/v1/castavridis.ghee5le5.json",map,totalArea=0;$(document).ready(function(){map=L.mapbox.map("map-view",TILE_JSON,{minZoom:12,maxZoom:17,maxBounds:[[38.5322,-90.4188],[38.7425,-90.0728]]});getParcels();getBubbles();map.on("zoomend",markersInView);map.on("drag",markersInView);map.on("moveend",markersInView);map.touchZoom.disable();map.doubleClickZoom.disable();map.scrollWheelZoom.disable();map.tap&&map.tap.disable();$(".dev").on("click",function(){$("#objectives-view").toggle()})});